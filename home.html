<!DOCTYPE html>
<html>
<head>
    <title>Drug Bag Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script>
        let ambulanceNumber = "";
        let drugBagID = "";
        let action = "";
        
        function showStep(step) {
            $(".step").hide();
            $(`#step${step}`).show();
        }
        
        function setAmbulanceNumber() {
            ambulanceNumber = document.getElementById("ambulanceInput").value;
            if (ambulanceNumber.length === 4) {
                showStep(2);
                startScanner();
            } else {
                alert("Please enter a valid 4-digit ambulance number.");
            }
        }
        
        function startScanner() {
            Quagga.init({
                inputStream: { type: "LiveStream", constraints: { facingMode: "environment" } },
                decoder: { readers: ["code_128_reader"] }
            }, function(err) {
                if (err) {
                    console.error(err);
                    return;
                }
                Quagga.start();
            });
            Quagga.onDetected(function(result) {
                Quagga.stop();
                drugBagID = result.codeResult.code;
                document.getElementById("barcodeInput").value = drugBagID;
                showStep(3);
            });
        }
        
        function setAction(choice) {
            action = choice;
            showStep(4);
        }
        
        function confirmSubmission() {
            let status = action === "out" ? "Out" : "In";
            let lastSeen = action === "out" ? ambulanceNumber : "Storage";
            
            fetch('https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action, ambulanceNumber, drugBagID, status, lastSeen }),
                mode: 'no-cors'
            }).then(() => {
                alert("Submission Successful");
                showStep(1);
                document.getElementById("ambulanceInput").value = "";
                document.getElementById("barcodeInput").value = "";
                ambulanceNumber = "";
                drugBagID = "";
                action = "";
            }).catch(error => {
                console.error("Error:", error);
                alert("There was an error with the request. Please try again.");
            });
        }
    </script>
</head>
<body class="container py-5">
    <h2 class="text-center">Drug Bag Tracker V2.1</h2>
    
    <div id="step1" class="step">
        <h3>Enter Ambulance Number</h3>
        <input type="text" id="ambulanceInput" class="form-control" maxlength="4">
        <button class="btn btn-primary mt-3" onclick="setAmbulanceNumber()">Next</button>
    </div>
    
    <div id="step2" class="step" style="display:none;">
        <h3>Scan Drug Bag</h3>
        <video id="scanner" class="w-100"></video>
        <input type="text" id="barcodeInput" class="form-control mt-3" placeholder="Scanned barcode will appear here" readonly>
        <button class="btn btn-primary mt-3" onclick="showStep(3)">Next</button>
    </div>
    
    <div id="step3" class="step" style="display:none;">
        <h3>Choose Action</h3>
        <button class="btn btn-success" onclick="setAction('in')">Book In</button>
        <button class="btn btn-danger" onclick="setAction('out')">Book Out</button>
    </div>
    
    <div id="step4" class="step" style="display:none;">
        <h3>Confirm Submission</h3>
        <button class="btn btn-primary" onclick="confirmSubmission()">Confirm</button>
    </div>
</body>
</html>



